"""This is the main life module."""

import numpy as np
from matplotlib import pyplot
from scipy.signal import convolve2d

glider = np.array([[0, 1, 0], [0, 0, 1], [1, 1, 1]])

blinker = np.array([
    [0, 0, 0],
    [1, 1, 1],
    [0, 0, 0]])

glider_gun = np.array([
    [0, 0, 0, 0, 1, 1, 0, 0, 0],
    [0, 0, 0, 0, 1, 1, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 1, 1, 0, 0],
    [0, 0, 0, 1, 0, 0, 0, 1, 0],
    [0, 0, 1, 0, 0, 0, 0, 0, 1],
    [0, 0, 1, 0, 0, 0, 0, 0, 1],
    [0, 0, 0, 0, 0, 1, 0, 0, 0],
    [0, 0, 0, 1, 0, 0, 0, 1, 0],
    [0, 0, 0, 0, 1, 1, 1, 0, 0],
    [0, 0, 0, 0, 0, 1, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 1, 1, 1, 0, 0, 0, 0],
    [0, 0, 1, 1, 1, 0, 0, 0, 0],
    [0, 1, 0, 0, 0, 1, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [1, 1, 0, 0, 0, 1, 1, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 1, 1, 0, 0, 0, 0, 0],
    [0, 0, 1, 1, 0, 0, 0, 0, 0]
])


class Game:
    """Implement the main game."""

    def __init__(self, size):
        """Set up the class."""
        self.board = np.zeros((size, size))

    def play(self):
        """Initialise the play."""
        print("Playing life. Press ctrl + c to stop.")
        pyplot.ion()
        while True:
            self.move()
            self.show()
            pyplot.pause(0.0000005)

    def move(self):
        """Define the move of the game."""
        stencil = np.array([[1, 1, 1], [1, 0, 1], [1, 1, 1]])
        neighbourcount = convolve2d(self.board, stencil, mode='same')

        for i in range(self.board.shape[0]):
            for j in range(self.board.shape[1]):
                self.board[i, j] = 1 if (neighbourcount[i, j] == 3 or
                                         (neighbourcount[i, j] == 2 and
                                         self.board[i, j])) else 0

    def __setitem__(self, key, value):
        """Set item."""
        self.board[key] = value

    def show(self):
        """Show item."""
        pyplot.clf()
        pyplot.matshow(self.board, fignum=0, cmap='binary')
        pyplot.show()

    def insert(self, pattern, loc):
        """Instert patterns in the game board."""
        pgrid = pattern.grid
        psize = pgrid.shape[1]
        (xtop, ytop) = tuple(np.array(loc)
                             - np.array((psize // 2, psize // 2)))
        (xmax, ymax) = (xtop + psize, ytop + psize)
        self.board[xtop:xmax, ytop:ymax] = (self.board[xtop:xmax, ytop:ymax]
                                            + pgrid) % 2


class Pattern:
    """Create the pattern class."""

    def __init__(self, grid):
        """Set up the class."""
        self.grid = grid

    def flip_vertical(self):
        """Flip a pattern vertically."""
        return Pattern(np.array(self.grid[::-1]))

    def flip_horizontal(self):
        """Flip a pattern horizontally."""
        return Pattern(np.array([a[::-1] for a in self.grid]))

    def flip_diag(self):
        """Flip a pattern along diagonal."""
        return Pattern(self.grid.transpose())

    def rotate(self, n):
        """Rotate by a fixed number of right angles."""
        counter = 0
        other = self
        while counter < n:
            other = other.flip_horizontal()
            other = other.flip_diag()
            counter += 1
        return other
